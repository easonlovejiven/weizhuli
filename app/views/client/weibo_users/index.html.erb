  <div class="info_name">
    粉丝管理
  </div>


  <ul class="nav nav-tabs">
    <li class="<%= action_name=="index" && @mod == nil ? "active" : ""%>"><a href="/client/weibo_users">高级粉丝 (<%=WeiboHighLevelFans.where(uid:@uid).level(2).count%>)</a></li>
    <li class="<%= action_name=="index" && @mod == "kol" ? "active" : ""%>"><a href="/client/weibo_users?mod=kol">KOL (<%=WeiboHighLevelFans.where(uid:@uid).level(1).count%>)</a></li>
    <li class="<%= action_name=="index" && @mod == "charts" ? "active" : ""%>"><a href="/client/weibo_users?mod=charts">图表</a></li>
  </ul>


  <div class="row-fluid search-box radius-3">
    <div class='title'>
      <strong>筛选条件</strong>
    </div>
    <div class="span12 conditions">
      <%=form_for :search, :url=>client_weibo_users_path,:method=>:get do |form|
        %>
      <div class="tags">
        <!--
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="is_friends" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">是</button>
              <button type="button" class="btn btn-mini" data-val="no">否</button>
          </div>
          <lable>我的关注</lable>
          <%=form.hidden_field :is_friends, :value=>@q[:is_friends]%>
          <%#=form.select :is_friends,options_for_select([["是否我的关注",""],["是",'yes'],["否","no"]],@q[:is_friends])%>
          
        </span>
      -->
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="is_verified" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">是</button>
              <button type="button" class="btn btn-mini" data-val="no">否</button>
          </div>
          <lable>认证用户</lable>
          <%=form.hidden_field :is_verified, :value=>@q[:is_verified]%>
          <%#=form.select :is_verified,options_for_select([["是否认证用户",""],["是",'yes'],["否","no"]],@q[:is_verified])%></span>
        <!--
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="has_interactions" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">有</button>
              <button type="button" class="btn btn-mini" data-val="no">无</button>
          </div>
          <lable>互动</lable>
          <%=form.hidden_field :has_interactions, :value=>@q[:has_interactions]%>
          <%#=form.select :has_interactions,options_for_select([["是否互动过",""],["是",'yes'],["否","no"]],@q[:has_interactions])%></span>
        -->
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="has_avatar" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">有</button>
              <button type="button" class="btn btn-mini" data-val="no">无</button>
          </div>
          <lable>头像</lable>
          <%=form.hidden_field :has_avatar, :value=>@q[:has_avatar]%>
          <%#=form.select :has_avatar,options_for_select([["是否有头像",""],["是",'yes'],["否","no"]],@q[:has_avatar])%></span>
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="gender" data-single-select>
              <button type="button" class="btn btn-mini" data-val="1">男</button>
              <button type="button" class="btn btn-mini" data-val="0">女</button>
          </div>
          <lable>性别</lable>
          <%=form.hidden_field :gender, :value=>@q[:gender]%>
          <%#=form.select :gender,options_for_select([["性别",""],["男",'1'],["女","0"]],@q[:gender])%></span>
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="has_email" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">有</button>
              <button type="button" class="btn btn-mini" data-val="no">无</button>
          </div>
          <lable>邮箱</lable>
          <%=form.hidden_field :has_email, :value=>@q[:has_email]%>
          <%#=form.select :has_email,options_for_select([["是否有邮箱",""],["是",'yes'],["否","no"]],@q[:has_email])%></span>
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="has_phone" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">有</button>
              <button type="button" class="btn btn-mini" data-val="no">无</button>
          </div>
          <lable>手机</lable>
          <%=form.hidden_field :has_phone, :value=>@q[:has_phone]%>
          <%#=form.select :has_phone,options_for_select([["是否有手机",""],["是",'yes'],["否","no"]],@q[:has_phone])%></span>
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="has_address" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">有</button>
              <button type="button" class="btn btn-mini" data-val="no">无</button>
          </div>
          <lable>地址</lable>
          <%=form.hidden_field :has_address, :value=>@q[:has_address]%>
          <%#=form.select :has_address,options_for_select([["是否有地址",""],["是",'yes'],["否","no"]],@q[:has_address])%></span>
        <span>
          <div class="btn-group" data-toggle="buttons-checkbox" data-bind="has_company" data-single-select>
              <button type="button" class="btn btn-mini" data-val="yes">有</button>
              <button type="button" class="btn btn-mini" data-val="no">无</button>
          </div>
          <lable>公司信息</lable>
          <%=form.hidden_field :has_company, :value=>@q[:has_company]%>
          <%#=form.select :has_company,options_for_select([["是否有公司信息",""],["是",'yes'],["否","no"]],@q[:has_company])%></span>
      </div>

      <div class="tags select-unit">
        <span><lable>关注数量: </lable><%=form.select :friends_range,options_for_select([["不限",""],"0-10",'11-50','51-100','101-200','201-500','501-1000','1000+'],@q[:friends_range])%></span>
        <span><lable>粉丝数量: </lable><%=form.select :followers_range,options_for_select([["不限",""],'0-500','501-1000','1001-5000','5001-10000','10001-500000','500001-1000000','1000001-5000000','5000001-10000000','10000000+'],@q[:followers_range])%></span>
        <span><lable>微博数量: </lable><%=form.select :weibo_number,options_for_select([["不限",""],'0-100','101-500','501-1000','1001-5000','5001-10000','10001+'],@q[:weibo_number])%></span>
        <span><lable>注册时间: </lable><%=form.select :reg_time,options_for_select([["不限",""],'0-100','101-200','201-300','301-400','401-500','501-600','601-700','701-800','801-900','901-1000','1000+'],@q[:reg_time])%></span>
        <br/>
        <span><lable>地域选择: </lable>
          <%=form.select :province,options_for_select([["不限",""]],@q[:province])%>
          <%=form.select :city,options_for_select([["不限",""]],@q[:city])%>
        </span>
        <span><lable>分组筛选: </lable><%=form.select :in_group,options_for_select([["不限",""]]+current_user.weibo_user_groups.map{|g| [g.name,g.id]},@q[:in_group])%>
        </span>
      </div>
      <div class="search-btn"><%=form.submit "搜索", :class=>"btn btn-info"%></div>
      <%end%>
    </div>
  </div>

  <div class="row-fluid fans-list-box radius-3">
		<div class='title'>
			<strong></strong>
      <!--
			<div class="btn-right">
				<button type="button" class="btn btn-default">添加备注</button>
				<button type="button" class="btn btn-default">添加分组</button>
			</div>
    -->
		</div>
    <div class="list">
      <table class='table table-hover'>
          <%
          s1 = sort_type(@sort_col,"total_interactions",@sort_type)

          l1 = sort_label(@sort_col,"total_interactions",@sort_type)
          %>

        <tr>
          <th></th>
          <th></th>
          <th>关注</th>
          <th>粉丝</th>
          <th>微博</th>
          <th>分组</th>
          <th><%=link_to "互动次数#{l1}", client_weibo_users_path(sort_type:s1,sort_col:"total_interactions")%></th>
          <th></th>
        </tr>
      <%@rels.each{|rel|
        user = rel.by_user
        next if user.nil?
        mu = MUser.find(user.uid)
        remark = @remarks[user.uid]
      %>
        <tr class="basic-row">
          <td></td>
          <td>
            <a href="http://weibo.com/<%=user.uid%>" target="_blank">
              <%=image_tag user.profile_image_url,:size=>"30x30", style:"float:left"%>
            </a>
              <span>
            <a href="http://weibo.com/<%=user.uid%>" target="_blank">
                <%=user.screen_name%>
            </a>
                <%if user.verified_type == 0%>
                  <i class="icon approve"></i>
                <%elsif (1..10).include?(user.verified_type)%>
                  <i class="icon approve_co"></i>
                <%end%>

                <br/>
                <%if user.gender == 1%>
                  <i class="icon male"></i>
                  男
                <%end%>
                <%if user.gender == 0%>
                  <i class="icon famale"></i>
                  女
                <%end%>
                <%=user.location%>
              </span>
          </td>
          <td><%=user.friends_count%></td>
          <td><%=user.followers_count%></td>
          <td><%=user.statuses_count%></td>
          <td>
            <div class="dropdown" data-uid='<%=user.uid%>'>
              <a class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#" href="/page.html">
                <%=remark.try(:group).try(:name) || "选择分组"%>
                <b class="caret"></b>
              </a>
              <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <li><a data-group-id=''>选择分组</a></li>
                <%current_user.weibo_user_groups.each{|group|%>
                <li><a tabindex='-1' href='javascript:;' data-group-id='<%=group.id%>'><%=group.name%></a></li>
                <%}%>
              </ul>
            </div>
            
          </td>
          <td>互动 <%=rel.total_interactions%> 次</td>
          <td><a>详情</a></td>
        </tr>
        <tr class="detail-row">
          <td colspan="9">
            <div class="span6">
              <ul>
                <li><span>认证: </span><%=user.human_verified_type.uniq*","%></li>
                <li><span>标签: </span><%=(mu.try(:tags)||[])*","%></li>
                <li><span>注册时间: </span><%=user.created_at.strftime("%Y-%m-%d %H:%M")%></li>
                <li><span>年龄: </span>暂无数据</li>
                <li><span>学校: </span>暂无数据</li>
                <li><span>简介: </span><%=mu&&mu.description%></li>
              </ul>
            </div>
            <div class="span6">
              <ul data-object="weibo_user_remark" data-url="/client/weibo_user_remarks/<%=user.uid%>">
                <li><span>备注: </span><span class="rest-in-place" data-attribute="demo"><%= remark.try(:demo) || '暂无数据'%></span></li>
                <li><span>真实姓名: </span><span class="rest-in-place" data-attribute="real_name"><%= remark.try(:real_name) || '暂无数据'%></span></li>
                <li><span>电话: </span><span class="rest-in-place" data-attribute="phone"><%= remark.try(:phone) || '暂无数据'%></span></li>
                <li><span>公司: </span><span class="rest-in-place" data-attribute="company"><%= remark.try(:company) || '暂无数据'%></span></li>
                <li><span>邮箱: </span><span class="rest-in-place" data-attribute="email"><%= remark.try(:email) || '暂无数据'%></span></li>
                <li><labspanel>地址: </span><span class="rest-in-place" data-attribute="address"><%= remark.try(:address) || '暂无数据'%></span></li>
              </ul>
            </div>
          </td>
        </tr>
      <%}%>
      </table>
    </div>

    <div>
      <div class="pagination" style='text-align:center'>
        <ul class="pagination">
          <%if @prev_page%>
          <li class="prev previous_page">
            <%params[:page] = @prev_page%>
            <%=link_to client_weibo_users_path(params) do%>
            &lt;&lt; 上一页
            <% end %>
          </li> 
          <%else%>
          <li class="prev previous_page disabled">
            <%=link_to "#" do%>
            &lt;&lt; 上一页
            <% end %>
          </li> 
          <%end%> 


          <%if @next_page%>
          <%params[:page] = @next_page%>
          <li class="next next_page">
            <%=link_to client_weibo_users_path(params) do%>
            下一页 &gt;&gt;
            <%end%>
          </li>
          <%else%>
          <li class="next next_page disabled">
            <%=link_to "#" do%>
            下一页 &gt;&gt;
            <%end%>
          </li>
          <%end%>
        </ul>
      </div>      
      <%#=will_paginate @rels,:renderer => WillPaginate::ActionView::BootstrapLinkRenderer%>
    </div>
  </div>

<%content_for :tail do%>
  <script>
    init_city_selects($("#search_province"),$("#search_city"),'<%=@q[:province]%>','<%=@q[:city]%>');

  </script>
<%end%>